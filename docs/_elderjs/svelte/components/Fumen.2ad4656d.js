import{S as e,i as t,s as r,e as n,c as i,a as o,d as a,b as c,f as s,g as u,n as f,o as l,h as p}from"../index-1cb8a252.js";var h="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function d(e){var t={exports:{}};return e(t,t.exports),t.exports}var v=d((function(e,t){var r,n;Object.defineProperty(t,"__esModule",{value:!0}),t.parseRotation=t.parseRotationName=t.Rotation=t.parsePiece=t.parsePieceName=t.isMinoPiece=t.Piece=void 0,function(e){e[e.Empty=0]="Empty",e[e.I=1]="I",e[e.L=2]="L",e[e.O=3]="O",e[e.Z=4]="Z",e[e.T=5]="T",e[e.J=6]="J",e[e.S=7]="S",e[e.Gray=8]="Gray"}(r=t.Piece||(t.Piece={})),t.isMinoPiece=function(e){return e!==r.Empty&&e!==r.Gray},t.parsePieceName=function(e){switch(e){case r.I:return"I";case r.L:return"L";case r.O:return"O";case r.Z:return"Z";case r.T:return"T";case r.J:return"J";case r.S:return"S";case r.Gray:return"X";case r.Empty:return"_"}throw new Error("Unknown piece: ".concat(e))},t.parsePiece=function(e){switch(e.toUpperCase()){case"I":return r.I;case"L":return r.L;case"O":return r.O;case"Z":return r.Z;case"T":return r.T;case"J":return r.J;case"S":return r.S;case"X":case"GRAY":return r.Gray;case" ":case"_":case"EMPTY":return r.Empty}throw new Error("Unknown piece: ".concat(e))},function(e){e[e.Spawn=0]="Spawn",e[e.Right=1]="Right",e[e.Reverse=2]="Reverse",e[e.Left=3]="Left"}(n=t.Rotation||(t.Rotation={})),t.parseRotationName=function(e){switch(e){case n.Spawn:return"spawn";case n.Left:return"left";case n.Right:return"right";case n.Reverse:return"reverse"}throw new Error("Unknown rotation: ".concat(e))},t.parseRotation=function(e){switch(e.toLowerCase()){case"spawn":return n.Spawn;case"left":return n.Left;case"right":return n.Right;case"reverse":return n.Reverse}throw new Error("Unknown rotation: ".concat(e))}})),y=d((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.getPieces=t.getBlocks=t.getBlockXYs=t.getBlockPositions=t.PlayField=t.InnerField=t.createInnerField=t.createNewInnerField=void 0;var r={Width:10,Height:23,PlayBlocks:230};t.createNewInnerField=function(){return new n({})},t.createInnerField=function(e){for(var t=new n({}),i=-1;i<r.Height;i+=1)for(var o=0;o<r.Width;o+=1){var a=e.at(o,i);t.setNumberAt(o,i,(0,v.parsePiece)(a))}return t};var n=function(){function e(t){var n=t.field,i=void 0===n?e.create(r.PlayBlocks):n,o=t.garbage,a=void 0===o?e.create(r.Width):o;this.field=i,this.garbage=a}return e.create=function(e){return new i({length:e})},e.prototype.fill=function(e){this.field.fill(e)},e.prototype.fillAll=function(e,t){this.field.fillAll(e,t)},e.prototype.canFill=function(e,t,n,i){var a=this;return o(e,t,n,i).every((function(e){var t=e[0],n=e[1];return 0<=t&&t<10&&0<=n&&n<r.Height&&a.getNumberAt(t,n)===v.Piece.Empty}))},e.prototype.canFillAll=function(e){var t=this;return e.every((function(e){var n=e.x,i=e.y;return 0<=n&&n<10&&0<=i&&i<r.Height&&t.getNumberAt(n,i)===v.Piece.Empty}))},e.prototype.isOnGround=function(e,t,r,n){return!this.canFill(e,t,r,n-1)},e.prototype.clearLine=function(){this.field.clearLine()},e.prototype.riseGarbage=function(){this.field.up(this.garbage),this.garbage.clearAll()},e.prototype.mirror=function(){this.field.mirror()},e.prototype.shiftToLeft=function(){this.field.shiftToLeft()},e.prototype.shiftToRight=function(){this.field.shiftToRight()},e.prototype.shiftToUp=function(){this.field.shiftToUp()},e.prototype.shiftToBottom=function(){this.field.shiftToBottom()},e.prototype.copy=function(){return new e({field:this.field.copy(),garbage:this.garbage.copy()})},e.prototype.equals=function(e){return this.field.equals(e.field)&&this.garbage.equals(e.garbage)},e.prototype.addNumber=function(e,t,r){0<=t?this.field.addOffset(e,t,r):this.garbage.addOffset(e,-(t+1),r)},e.prototype.setNumberFieldAt=function(e,t){this.field.setAt(e,t)},e.prototype.setNumberGarbageAt=function(e,t){this.garbage.setAt(e,t)},e.prototype.setNumberAt=function(e,t,r){return 0<=t?this.field.set(e,t,r):this.garbage.set(e,-(t+1),r)},e.prototype.getNumberAt=function(e,t){return 0<=t?this.field.get(e,t):this.garbage.get(e,-(t+1))},e.prototype.getNumberAtIndex=function(e,t){return t?this.getNumberAt(e%10,Math.floor(e/10)):this.getNumberAt(e%10,-(Math.floor(e/10)+1))},e.prototype.toFieldNumberArray=function(){return this.field.toArray()},e.prototype.toGarbageNumberArray=function(){return this.garbage.toArray()},e}();t.InnerField=n;var i=function(){function e(e){var t=e.pieces,n=e.length,i=void 0===n?r.PlayBlocks:n;this.pieces=void 0!==t?t:Array.from({length:i}).map((function(){return v.Piece.Empty})),this.length=i}return e.load=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=t.join("").trim();return e.loadInner(n)},e.loadMinify=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=t.join("").trim();return e.loadInner(n,n.length)},e.loadInner=function(t,r){var n=void 0!==r?r:t.length;if(n%10!=0)throw new Error("Num of blocks in field should be mod 10");for(var i=new e(void 0!==r?{length:r}:{}),o=0;o<n;o+=1){var a=t[o];i.set(o%10,Math.floor((n-o-1)/10),(0,v.parsePiece)(a))}return i},e.prototype.get=function(e,t){return this.pieces[e+t*r.Width]},e.prototype.addOffset=function(e,t,n){this.pieces[e+t*r.Width]+=n},e.prototype.set=function(e,t,n){this.setAt(e+t*r.Width,n)},e.prototype.setAt=function(e,t){this.pieces[e]=t},e.prototype.fill=function(e){for(var t=e.type,r=e.rotation,n=e.x,i=e.y,o=0,c=a(t,r);o<c.length;o++){var s=c[o],u=[n+s[0],i+s[1]],f=u[0],l=u[1];this.set(f,l,t)}},e.prototype.fillAll=function(e,t){for(var r=0,n=e;r<n.length;r++){var i=n[r],o=i.x,a=i.y;this.set(o,a,t)}},e.prototype.clearLine=function(){for(var e=this.pieces.concat(),t=this.pieces.length/r.Width-1;0<=t;t-=1){if(this.pieces.slice(t*r.Width,(t+1)*r.Width).every((function(e){return e!==v.Piece.Empty}))){var n=e.slice(0,t*r.Width),i=e.slice((t+1)*r.Width);e=n.concat(i,Array.from({length:r.Width}).map((function(){return v.Piece.Empty})))}}this.pieces=e},e.prototype.up=function(e){this.pieces=e.pieces.concat(this.pieces).slice(0,this.length)},e.prototype.mirror=function(){for(var e=[],t=0;t<this.pieces.length;t+=1){var n=this.pieces.slice(t*r.Width,(t+1)*r.Width);n.reverse();for(var i=0,o=n;i<o.length;i++){var a=o[i];e.push(a)}}this.pieces=e},e.prototype.shiftToLeft=function(){for(var e=this.pieces.length/10,t=0;t<e;t+=1){for(var n=0;n<r.Width-1;n+=1)this.pieces[n+t*r.Width]=this.pieces[n+1+t*r.Width];this.pieces[9+t*r.Width]=v.Piece.Empty}},e.prototype.shiftToRight=function(){for(var e=this.pieces.length/10,t=0;t<e;t+=1){for(var n=r.Width-1;1<=n;n-=1)this.pieces[n+t*r.Width]=this.pieces[n-1+t*r.Width];this.pieces[t*r.Width]=v.Piece.Empty}},e.prototype.shiftToUp=function(){var e=Array.from({length:10}).map((function(){return v.Piece.Empty}));this.pieces=e.concat(this.pieces).slice(0,this.length)},e.prototype.shiftToBottom=function(){var e=Array.from({length:10}).map((function(){return v.Piece.Empty}));this.pieces=this.pieces.slice(10,this.length).concat(e)},e.prototype.toArray=function(){return this.pieces.concat()},Object.defineProperty(e.prototype,"numOfBlocks",{get:function(){return this.pieces.length},enumerable:!1,configurable:!0}),e.prototype.copy=function(){return new e({pieces:this.pieces.concat(),length:this.length})},e.prototype.toShallowArray=function(){return this.pieces},e.prototype.clearAll=function(){this.pieces=this.pieces.map((function(){return v.Piece.Empty}))},e.prototype.equals=function(e){if(this.pieces.length!==e.pieces.length)return!1;for(var t=0;t<this.pieces.length;t+=1)if(this.pieces[t]!==e.pieces[t])return!1;return!0},e}();function o(e,t,r,n){return a(e,t).map((function(e){return e[0]+=r,e[1]+=n,e}))}function a(e,t){var r=c(e);switch(t){case v.Rotation.Spawn:return r;case v.Rotation.Left:return r.map((function(e){return[-e[1],e[0]]}));case v.Rotation.Reverse:return function(e){return e.map((function(e){return[-e[0],-e[1]]}))}(r);case v.Rotation.Right:return function(e){return e.map((function(e){return[e[1],-e[0]]}))}(r)}throw new Error("Unsupported block")}function c(e){switch(e){case v.Piece.I:return[[0,0],[-1,0],[1,0],[2,0]];case v.Piece.T:return[[0,0],[-1,0],[1,0],[0,1]];case v.Piece.O:return[[0,0],[1,0],[0,1],[1,1]];case v.Piece.L:return[[0,0],[-1,0],[1,0],[1,1]];case v.Piece.J:return[[0,0],[-1,0],[1,0],[-1,1]];case v.Piece.S:return[[0,0],[-1,0],[0,1],[1,1]];case v.Piece.Z:return[[0,0],[1,0],[0,1],[-1,1]]}throw new Error("Unsupported rotation")}t.PlayField=i,t.getBlockPositions=o,t.getBlockXYs=function(e,t,r,n){return a(e,t).map((function(e){return{x:e[0]+r,y:e[1]+n}}))},t.getBlocks=a,t.getPieces=c})),g=d((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Buffer=void 0;var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=function(){function e(e){void 0===e&&(e=""),this.values=e.split("").map(i)}return e.prototype.poll=function(t){for(var r=0,n=0;n<t;n+=1){var i=this.values.shift();if(void 0===i)throw new Error("Unexpected fumen");r+=i*Math.pow(e.tableLength,n)}return r},e.prototype.push=function(t,r){void 0===r&&(r=1);for(var n=t,i=0;i<r;i+=1)this.values.push(n%e.tableLength),n=Math.floor(n/e.tableLength)},e.prototype.merge=function(e){for(var t=0,r=e.values;t<r.length;t++){var n=r[t];this.values.push(n)}},e.prototype.isEmpty=function(){return 0===this.values.length},Object.defineProperty(e.prototype,"length",{get:function(){return this.values.length},enumerable:!1,configurable:!0}),e.prototype.get=function(e){return this.values[e]},e.prototype.set=function(e,t){this.values[e]=t},e.prototype.toString=function(){return this.values.map(o).join("")},e.tableLength=r.length,e}();function i(e){return r.indexOf(e)}function o(e){return r[e]}t.Buffer=n})),m=d((function(e,t){var r=h&&h.__assign||function(){return r=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},r.apply(this,arguments)};function n(e){return 0!==e}Object.defineProperty(t,"__esModule",{value:!0}),t.createActionEncoder=t.createActionDecoder=void 0;function i(e){return e?1:0}t.createActionDecoder=function(e,t,i){var o=(t+i)*e;return{decode:function(i){var a=i,c=function(e){switch(e){case 0:return v.Piece.Empty;case 1:return v.Piece.I;case 2:return v.Piece.L;case 3:return v.Piece.O;case 4:return v.Piece.Z;case 5:return v.Piece.T;case 6:return v.Piece.J;case 7:return v.Piece.S;case 8:return v.Piece.Gray}throw new Error("Unexpected piece")}(a%8),s=function(e){switch(e){case 0:return v.Rotation.Reverse;case 1:return v.Rotation.Right;case 2:return v.Rotation.Spawn;case 3:return v.Rotation.Left}throw new Error("Unexpected rotation")}((a=Math.floor(a/8))%4),u=function(r,n,i){var o=r%e,a=Math.floor(r/10),c=t-a-1;return n===v.Piece.O&&i===v.Rotation.Left?(o+=1,c-=1):n===v.Piece.O&&i===v.Rotation.Reverse?o+=1:n===v.Piece.O&&i===v.Rotation.Spawn?c-=1:n===v.Piece.I&&i===v.Rotation.Reverse?o+=1:n===v.Piece.I&&i===v.Rotation.Left||n===v.Piece.S&&i===v.Rotation.Spawn?c-=1:n===v.Piece.S&&i===v.Rotation.Right?o-=1:n===v.Piece.Z&&i===v.Rotation.Spawn?c-=1:n===v.Piece.Z&&i===v.Rotation.Left&&(o+=1),{x:o,y:c}}((a=Math.floor(a/4))%o,c,s);return{rise:n((a=Math.floor(a/o))%2),mirror:n((a=Math.floor(a/2))%2),colorize:n((a=Math.floor(a/2))%2),comment:n((a=Math.floor(a/2))%2),lock:!n((a=Math.floor(a/2))%2),piece:r(r({},u),{type:c,rotation:s})}}}};t.createActionEncoder=function(e,t,r){var n=(t+r)*e;return{encode:function(r){var o,a,c,s,u,f=r.lock,l=r.comment,p=r.colorize,h=r.mirror,d=r.rise,y=r.piece,g=i(!f);return g*=2,g+=i(l),g*=2,g+=i(p),g*=2,g+=i(h),g*=2,g+=i(d),g*=n,g+=(a=(o=y).type,c=o.rotation,s=o.x,u=o.y,(0,v.isMinoPiece)(a)?a===v.Piece.O&&c===v.Rotation.Left?(s-=1,u+=1):a===v.Piece.O&&c===v.Rotation.Reverse?s-=1:a===v.Piece.O&&c===v.Rotation.Spawn?u+=1:a===v.Piece.I&&c===v.Rotation.Reverse?s-=1:a===v.Piece.I&&c===v.Rotation.Left||a===v.Piece.S&&c===v.Rotation.Spawn?u+=1:a===v.Piece.S&&c===v.Rotation.Right?s+=1:a===v.Piece.Z&&c===v.Rotation.Spawn?u+=1:a===v.Piece.Z&&c===v.Rotation.Left&&(s-=1):(s=0,u=22),(t-u-1)*e+s),g*=4,g+=function(e){var t=e.type,r=e.rotation;if(!(0,v.isMinoPiece)(t))return 0;switch(r){case v.Rotation.Reverse:return 0;case v.Rotation.Right:return 1;case v.Rotation.Spawn:return 2;case v.Rotation.Left:return 3}throw new Error("No reachable")}(y),g*=8,g+=y.type}}}})),w=d((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.createCommentParser=void 0;var r=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~",n=r.length+1;t.createCommentParser=function(){return{decode:function(e){for(var t="",i=e,o=0;o<4;o+=1){t+=r[i%n],i=Math.floor(i/n)}return t},encode:function(e,t){return r.indexOf(e)*Math.pow(n,t)}}}})),b=d((function(e,t){var r;Object.defineProperty(t,"__esModule",{value:!0}),t.Quiz=void 0,function(e){e.Direct="direct",e.Swap="swap",e.Stock="stock"}(r||(r={}));var n=function(){function e(t){this.quiz=e.verify(t)}return Object.defineProperty(e.prototype,"next",{get:function(){var e=this.quiz.indexOf(")")+1,t=this.quiz[e];return void 0===t||";"===t?"":t},enumerable:!1,configurable:!0}),e.isQuizComment=function(e){return e.startsWith("#Q=")},e.create=function(t,r){var n=function(t,r){var n=function(e){return e||""};return new e("#Q=[".concat(n(t),"](").concat(n(r[0]),")").concat(n(r.substring(1))))};return void 0!==r?n(t,r):n(void 0,t)},e.trim=function(e){return e.trim().replace(/\s+/g,"")},Object.defineProperty(e.prototype,"least",{get:function(){var e=this.quiz.indexOf(")");return this.quiz.substr(e+1)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"current",{get:function(){var e=this.quiz.indexOf("(")+1,t=this.quiz[e];return")"===t?"":t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hold",{get:function(){var e=this.quiz.indexOf("[")+1,t=this.quiz[e];return"]"===t?"":t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"leastAfterNext2",{get:function(){var e=this.quiz.indexOf(")");return";"===this.quiz[e+1]?this.quiz.substr(e+1):this.quiz.substr(e+2)},enumerable:!1,configurable:!0}),e.prototype.getOperation=function(e){var t=(0,v.parsePieceName)(e),n=this.current;if(t===n)return r.Direct;var i=this.hold;if(t===i)return r.Swap;if(""===i){if(t===this.next)return r.Stock}else if(""===n&&t===this.next)return r.Direct;throw new Error("Unexpected hold piece in quiz: ".concat(this.quiz))},Object.defineProperty(e.prototype,"leastInActiveBag",{get:function(){var e=this.quiz.indexOf(";"),t=0<=e?this.quiz.substring(0,e):this.quiz,r=t.indexOf(")");return";"===t[r+1]?t.substr(r+1):t.substr(r+2)},enumerable:!1,configurable:!0}),e.verify=function(e){var t=this.trim(e);if(0===t.length||"#Q=[]()"===e||!e.startsWith("#Q="))return e;if(!t.match(/^#Q=\[[TIOSZJL]?]\([TIOSZJL]?\)[TIOSZJL]*;?.*$/i))throw new Error("Current piece doesn't exist, however next pieces exist: ".concat(e));return t},e.prototype.direct=function(){if(""===this.current){var t=this.leastAfterNext2;return new e("#Q=[".concat(this.hold,"](").concat(t[0],")").concat(t.substr(1)))}return new e("#Q=[".concat(this.hold,"](").concat(this.next,")").concat(this.leastAfterNext2))},e.prototype.swap=function(){if(""===this.hold)throw new Error("Cannot find hold piece: ".concat(this.quiz));var t=this.next;return new e("#Q=[".concat(this.current,"](").concat(t,")").concat(this.leastAfterNext2))},e.prototype.stock=function(){if(""!==this.hold||""===this.next)throw new Error("Cannot stock: ".concat(this.quiz));var t=this.leastAfterNext2,r=void 0!==t[0]?t[0]:"";return 1<t.length?new e("#Q=[".concat(this.current,"](").concat(r,")").concat(t.substr(1))):new e("#Q=[".concat(this.current,"](").concat(r,")"))},e.prototype.operate=function(e){switch(e){case r.Direct:return this.direct();case r.Swap:return this.swap();case r.Stock:return this.stock()}throw new Error("Unexpected operation")},e.prototype.format=function(){var t=this.nextIfEnd();if("#Q=[]()"===t.quiz)return new e("");var r=t.current,n=t.hold;if(""===r&&""!==n)return new e("#Q=[](".concat(n,")").concat(t.least));if(""===r){var i=t.least,o=i[0];return new e(void 0===o?"":";"===o?i.substr(1):"#Q=[](".concat(o,")").concat(i.substr(1)))}return t},e.prototype.getHoldPiece=function(){if(!this.canOperate())return v.Piece.Empty;var e=this.hold;return void 0===e||""===e||";"===e?v.Piece.Empty:(0,v.parsePiece)(e)},e.prototype.getNextPieces=function(e){if(!this.canOperate())return void 0!==e?Array.from({length:e}).map((function(){return v.Piece.Empty})):[];var t=(this.current+this.next+this.leastInActiveBag).substr(0,e);return void 0!==e&&t.length<e&&(t+=" ".repeat(e-t.length)),t.split("").map((function(e){return void 0===e||" "===e||";"===e?v.Piece.Empty:(0,v.parsePiece)(e)}))},e.prototype.toString=function(){return this.quiz},e.prototype.canOperate=function(){var e=this.quiz;return e.startsWith("#Q=[]();")&&(e=this.quiz.substr(8)),e.startsWith("#Q=")&&"#Q=[]()"!==e},e.prototype.nextIfEnd=function(){return this.quiz.startsWith("#Q=[]();")?new e(this.quiz.substr(8)):this},e}();t.Quiz=n})),P=d((function(e,t){var r=h&&h.__assign||function(){return r=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},r.apply(this,arguments)};function n(e){return e instanceof o?e.copy():o.from(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.Mino=t.Field=void 0;var i=function(){function e(e){this.field=e}return e.create=function(t,r){return new e(new y.InnerField({field:void 0!==t?y.PlayField.load(t):void 0,garbage:void 0!==r?y.PlayField.loadMinify(r):void 0}))},e.prototype.canFill=function(e){if(void 0===e)return!0;var t=n(e);return this.field.canFillAll(t.positions())},e.prototype.canLock=function(e){return void 0===e||!!this.canFill(e)&&!this.canFill(r(r({},e),{y:e.y-1}))},e.prototype.fill=function(e,t){if(void 0===t&&(t=!1),void 0!==e){var r=n(e);if(!t&&!this.canFill(r))throw Error("Cannot fill piece on field");return this.field.fillAll(r.positions(),(0,v.parsePiece)(r.type)),r}},e.prototype.put=function(e){if(void 0!==e){for(var t=n(e);0<=t.y;t.y-=1)if(this.canLock(t))return this.fill(t),t;throw Error("Cannot put piece on field")}},e.prototype.clearLine=function(){this.field.clearLine()},e.prototype.at=function(e,t){return(0,v.parsePieceName)(this.field.getNumberAt(e,t))},e.prototype.set=function(e,t,r){this.field.setNumberAt(e,t,(0,v.parsePiece)(r))},e.prototype.copy=function(){return new e(this.field.copy())},e.prototype.str=function(e){void 0===e&&(e={});for(var t=void 0===e.reduced||e.reduced,r=void 0!==e.separator?e.separator:"\n",n=void 0===e.garbage||e.garbage?-1:0,i="",o=22;n<=o;o-=1){for(var a="",c=0;c<10;c+=1)a+=this.at(c,o);t&&"__________"===a||(t=!1,i+=a,o!==n&&(i+=r))}return i},e}();t.Field=i;var o=function(){function e(e,t,r,n){this.type=e,this.rotation=t,this.x=r,this.y=n}return e.from=function(t){return new e(t.type,t.rotation,t.x,t.y)},e.prototype.positions=function(){return(0,y.getBlockXYs)((0,v.parsePiece)(this.type),(0,v.parseRotation)(this.rotation),this.x,this.y).sort((function(e,t){return e.y===t.y?e.x-t.x:e.y-t.y}))},e.prototype.operation=function(){return{type:this.type,rotation:this.rotation,x:this.x,y:this.y}},e.prototype.isValid=function(){try{(0,v.parsePiece)(this.type),(0,v.parseRotation)(this.rotation)}catch(e){return!1}return this.positions().every((function(e){var t=e.x,r=e.y;return 0<=t&&t<10&&0<=r&&r<23}))},e.prototype.copy=function(){return new e(this.type,this.rotation,this.x,this.y)},e}();t.Mino=o})),x=d((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.decode=t.extract=t.Page=void 0;var r=function(){function e(e,t,r,n,i,o){this.index=e,this.operation=r,this.comment=n,this.flags=i,this.refs=o,this._field=t.copy()}return Object.defineProperty(e.prototype,"field",{get:function(){return new P.Field(this._field.copy())},set:function(e){this._field=(0,y.createInnerField)(e)},enumerable:!1,configurable:!0}),e.prototype.mino=function(){return P.Mino.from(this.operation)},e}();t.Page=r;var n=1,i=10;function o(e){var t,r=function(e,t){return{version:e,data:t.trim().replace(/[?\s]+/g,"")}},n=e,i=n.indexOf("&");if(0<=i&&(n=n.substring(0,i)),null!=(t=e.match(/[vmd]115@/))&&void 0!==t.index)return r("115",n.substr(t.index+5));if(null!=(t=e.match(/[vmd]110@/))&&void 0!==t.index)return r("110",n.substr(t.index+5));throw new Error("Unsupported fumen version")}function a(e,t){for(var o=(t+n)*i,a=new g.Buffer(e),c=function(e){for(var r={changed:!1,field:e},n=0;n<o;){var c=a.poll(2),s=Math.floor(c/o),u=c%o;u!==o-1&&(r.changed=!0);for(var f=0;f<u+1;f+=1){var l=n%i,p=t-Math.floor(n/i)-1;r.field.addNumber(l,p,s-8),n+=1}}return r},s=0,u=(0,y.createNewInnerField)(),f={repeatCount:-1,refIndex:{comment:0,field:0},quiz:void 0,lastCommentText:""},l=[],p=(0,m.createActionDecoder)(i,t,n),h=(0,w.createCommentParser)();!a.isEmpty();){var d=void 0;0<f.repeatCount?(d={field:u,changed:!1},f.repeatCount-=1):(d=c(u.copy())).changed||(f.repeatCount=a.poll(1));var x=a.poll(3),O=p.decode(x),R=void 0;if(O.comment){for(var z=[],E=a.poll(2),A=0;A<Math.floor((E+3)/4);A+=1){var k=a.poll(5);z.push(k)}for(var M="",S=0,$=z;S<$.length;S++){var _=$[S];M+=h.decode(_)}var I=unescape(M.slice(0,E));f.lastCommentText=I,R={text:I},f.refIndex.comment=s;var L=R.text;if(b.Quiz.isQuizComment(L))try{f.quiz=new b.Quiz(L)}catch(e){f.quiz=void 0}else f.quiz=void 0}else R=0===s?{text:""}:{text:void 0!==f.quiz?f.quiz.format().toString():void 0,ref:f.refIndex.comment};var q=!1;if(void 0!==f.quiz&&(q=!0,f.quiz.canOperate()&&O.lock))if((0,v.isMinoPiece)(O.piece.type))try{var N=f.quiz.nextIfEnd(),j=N.getOperation(O.piece.type);f.quiz=N.operate(j)}catch(e){f.quiz=f.quiz.format()}else f.quiz=f.quiz.format();var T=void 0;O.piece.type!==v.Piece.Empty&&(T=O.piece);var F=void 0;d.changed||0===s?(F={},f.refIndex.field=s):F={ref:f.refIndex.field},l.push(new r(s,d.field,void 0!==T?P.Mino.from({type:(0,v.parsePieceName)(T.type),rotation:(0,v.parseRotationName)(T.rotation),x:T.x,y:T.y}):void 0,void 0!==R.text?R.text:f.lastCommentText,{quiz:q,lock:O.lock,mirror:O.mirror,colorize:O.colorize,rise:O.rise},{field:F.ref,comment:R.ref})),s+=1,O.lock&&((0,v.isMinoPiece)(O.piece.type)&&d.field.fill(O.piece),d.field.clearLine(),O.rise&&d.field.riseGarbage(),O.mirror&&d.field.mirror()),u=d.field}return l}t.extract=o,t.decode=function(e){var t=o(e),r=t.version,n=t.data;switch(r){case"115":return a(n,23);case"110":return a(n,21)}throw new Error("Unsupported fumen version")}})),O=d((function(e,t){var r=h&&h.__assign||function(){return r=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},r.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.encode=void 0;var n=1,i=10;t.encode=function(e){for(var t=function(e,t){var r=function(e,t){for(var r=23,n=r+1,o=n*i,a=new g.Buffer,c=function(n,i){var o=r-i-1;return t.getNumberAt(n,o)-e.getNumberAt(n,o)+8},s=function(e,t){var r=e*o+t;a.push(r,2)},u=!1,f=c(0,0),l=-1,p=0;p<n;p+=1)for(var h=0;h<i;h+=1){var d=c(h,p);d!==f?(s(f,l),l=0,f=d,u=!0):l+=1}return s(f,l),{changed:u,values:a}}(e,t),n=r.changed,c=r.values;if(n)a.merge(c),o=-1;else if(o<0||a.get(o)===g.Buffer.tableLength-1)a.merge(c),a.push(0),o=a.length-1;else if(a.get(o)<g.Buffer.tableLength-1){var s=a.get(o);a.set(o,s+1)}},o=-1,a=new g.Buffer,c=(0,y.createNewInnerField)(),s=(0,m.createActionEncoder)(i,23,n),u=(0,w.createCommentParser)(),f="",l=void 0,p=function(n){var i=e[n];i.flags=i.flags?i.flags:{};var o=i.field,p=void 0!==o?(0,y.createInnerField)(o):c.copy();t(c,p);var h,d=void 0!==i.comment&&(0!==n||""!==i.comment)?i.comment:void 0,g=void 0!==i.operation?{type:(0,v.parsePiece)(i.operation.type),rotation:(0,v.parseRotation)(i.operation.rotation),x:i.operation.x,y:i.operation.y}:{type:v.Piece.Empty,rotation:v.Rotation.Reverse,x:0,y:22};if(void 0!==d?d.startsWith("#Q=")?void 0!==l&&l.format().toString()===d?h=void 0:(f=h=d,l=new b.Quiz(d)):void 0!==l&&l.format().toString()===d?(h=void 0,f=d,l=void 0):(h=f!==d?d:void 0,f=f!==d?h:f,l=void 0):(h=void 0,l=void 0),void 0!==l&&l.canOperate()&&i.flags.lock)if((0,v.isMinoPiece)(g.type))try{var m=l.nextIfEnd(),w=m.getOperation(g.type);l=m.operate(w)}catch(e){l=l.format()}else l=l.format();var P=r({lock:!0,colorize:0===n},i.flags),x={piece:g,rise:!!P.rise,mirror:!!P.mirror,colorize:!!P.colorize,lock:!!P.lock,comment:void 0!==h},O=s.encode(x);if(a.push(O,3),void 0!==h){var R=escape(i.comment),z=Math.min(R.length,4095);a.push(z,2);for(var E=0;E<z;E+=4){for(var A=0,k=0;k<4;k+=1){var M=E+k;if(z<=M)break;var S=R.charAt(M);A+=u.encode(S,k)}a.push(A,5)}}else void 0===i.comment&&(f=void 0);x.lock&&((0,v.isMinoPiece)(x.piece.type)&&p.fill(x.piece),p.clearLine(),x.rise&&p.riseGarbage(),x.mirror&&p.mirror()),c=p},h=0;h<e.length;h+=1)p(h);var d=a.toString();if(d.length<41)return d;var P=[d.substr(0,42)],x=d.substring(42).match(/[\S]{1,47}/g)||[];return P.concat(x).join("?")}})),R=d((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.encoder=t.decoder=t.Mino=t.Field=void 0,Object.defineProperty(t,"Field",{enumerable:!0,get:function(){return P.Field}}),Object.defineProperty(t,"Mino",{enumerable:!0,get:function(){return P.Mino}}),t.decoder={decode:function(e){return(0,x.decode)(e)}},t.encoder={encode:function(e){return"v115@".concat((0,O.encode)(e))}}})),z=/["'&<>]/,E=function(e){var t,r=""+e,n=z.exec(r);if(!n)return r;var i="",o=0,a=0;for(o=n.index;o<r.length;o++){switch(r.charCodeAt(o)){case 34:t="&quot;";break;case 38:t="&amp;";break;case 39:t="&#39;";break;case 60:t="&lt;";break;case 62:t="&gt;";break;default:continue}a!==o&&(i+=r.substring(a,o)),a=o+1,i+=t}return a!==o?i+r.substring(a,o):i};const{decoder:A}=R,k={_:"#000",X:"#999",Xl:"#ccc",I:"hsl(180, 100%, 35%)",Il:"#0ff",L:"hsl(30, 95%, 47%)",Ll:"hsl(36, 100%, 55%)",O:"hsl(60, 70%, 40%)",Ol:"#ff0",Z:"hsl(0, 70%, 50%)",Zl:"hsl(0, 100%, 63%)",T:"hsl(295, 80%, 47%)",Tl:"hsl(300, 90%, 57%)",J:"hsl(240, 75%, 50%)",Jl:"hsl(240, 100%, 60%)",S:"hsl(120, 100%, 33%)",Sl:"#0f0"};function M(e,t){return`<rect id="t${e}" fill="${k[e]}" width="${t}" height="${t}"${"_"===e?' stroke="rgba(255,255,255,0.05)"':""}/>`}function S(e){const t=e.field.copy(),r=e.operation&&t.fill(e.operation),n=Array(200),i=new Set;for(let e=0;e<20;e++)for(let r=0;r<10;r++)n[10*e+r]={type:t.at(r,e),light:!1};if(r)for(const{x:e,y:t}of r.positions())i.add(t),n[10*t+e].light=!0;if(e.flags.lock)for(const e of i)if($(t,e))for(let t=0;t<10;t++)n[10*e+t].light=!0;return n}function $(e,t){for(let r=0;r<10;r++)if("_"===e.at(r,t))return!1;return!0}function _({text:e,width:t,height:r,y:n,size:i,offset:o,index:a}){if(!e&&a)return"";return(0===a?`<rect id="cbg" fill="#333" y="${n}" width="${t}" height="${r}"/>`:'<use href="#cbg"/>')+(e?`<text x="${t/2}" y="${n+o}" text-anchor="middle" font-size="${i}" fill="white">${E(e)}</text>`:"")}function I(e,t,r,n){return 0===e?"":"css"===n?`<style>\n      #f${e} {\n        animation: a${e} ${t*r}ms step-end infinite;\n      }\n      @keyframes a${e} {\n        0% {visibility: hidden} ${100*e/t}% {visibility: visible}\n      }\n    </style>`:`<animate attributeName="display" values="none;inline" calcMode="discrete" keyTimes="0;${e/t}" dur="${r*t}ms" repeatCount="indefinite" />`}function L(e,t){const r=[],n=[],i=new Set;for(let o=0;o<e.length;o++){if(!e[o])continue;const a=`${e[o].type}${e[o].light?"l":""}`;i.add(a);const c=`<use href="#t${a}" x="${o%10*t}" y="${(20-Math.floor(o/10)-1)*t}"/>`;"_"===a?r.push(c):n.push(c)}return{used:i,tiles:r.concat(n)}}var q={createSVG:function({data:e,pages:t=A.decode(e),index:r,delay:n=500,size:i=16,commentSize:o=16,animateType:a="css",comment:c="auto"}){null!=r&&(t=t.slice(r,r+1));const s=t.map(S),u="always"===c||"none"!==c&&t.some((e=>e.comment)),f=Math.round(1.6*o),l=1.2*o,p=20*i,h=10*i,d=20*i+(u?f:0);for(let e=s.length-1;e>=1;e--)for(let t=0;t<s[e].length;t++)v=s[e-1][t],y=s[e][t],v.type===y.type&&v.light===y.light&&(s[e][t]=null);var v,y;for(let e=t.length-1;e>=1;e--)t[e].comment&&t[e].comment===t[e-1].comment&&(t[e].comment=null);const g=[],m=new Set;for(let e=0;e<s.length;e++){const r=L(s[e],i);for(const e of r.used)m.add(e);const c=u?_({text:t[e].comment,width:h,height:f,y:p,size:o,offset:l,index:e}):"";g.push(`\n      <svg viewBox="0 0 ${h} ${d}" id="f${e}">\n        ${r.tiles.join("")}\n        ${c}\n        ${I(e,s.length,n,a)}\n      </svg>`)}return`\n    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 ${h} ${d}" width="${h}" height="${d}" style="font-family: sans-serif">\n      <defs>\n        ${function(e,t){const r=[];for(const n of e)r.push(M(n,t));return r.join("")}(m,i)}\n      </defs>\n      ${g.join("")}\n      ${function(e,t,r,n,i){if(1===t)return"";const o=`d="M 0,${e} H${r}" stroke="silver" stroke-width="${r/50}" stroke-dasharray="${r}"`;if("css"===i)return`\n      <path ${o} id="p"/>\n      <style>\n        #p {animation: p ${n*t}ms steps(${t}, start) infinite}\n        @keyframes p {\n          from {\n            stroke-dashoffset: ${r};\n          }\n          to {\n            stroke-dashoffset: 0;\n          }\n        }\n      </style>`;return`\n    <path ${o}>\n      <animate attributeName="stroke-dashoffset" values="${a()}" calcMode="discrete" dur="${t*n}ms" repeatCount="indefinite"/>\n    </path>`;function a(){const e=[];for(let n=0;n<t;n++)e.push((t-n-1)/t*r);return e.join(";")}}(p,s.length,h,n,a)}\n    </svg>`.trim().replace(/>\s+</g,">\n<")}};const N={_xo:null,storage:new Map,observe:function(e,t,r){N.storage.set(e,{load:t,unload:r}),N._xo.observe(e)},unobserve:function(e){N.storage.delete(e),N._xo.unobserve(e)}},j=new Set;let T;function F(){return N._xo||(N._xo=new IntersectionObserver(W)),N}function W(e){clearTimeout(T),T=setTimeout(B,30);for(const t of e)t.isIntersecting?j.add(t.target):(j.delete(t.target),N.storage.get(t.target).unload())}function B(){for(const e of j)N.storage.get(e).load();j.clear()}function Q(e){let t,r;return{c(){t=n("a"),this.h()},l(e){t=i(e,"A",{class:!0,href:!0}),o(t).forEach(a),this.h()},h(){c(t,"class","fumen svelte-bp5hiz"),c(t,"href",r="https://harddrop.com/fumen/?"+e[0]),s(t,"width",e[1],!1),s(t,"height",e[2],!1)},m(r,n){u(r,t,n),e[5](t)},p(e,[n]){1&n&&r!==(r="https://harddrop.com/fumen/?"+e[0])&&c(t,"href",r),2&n&&s(t,"width",e[1],!1),4&n&&s(t,"height",e[2],!1)},i:f,o:f,d(r){r&&a(t),e[5](null)}}}function C(e,t,r){let n,i,{data:o}=t,{delay:a}=t,{width:c}=t,{height:s}=t;function u(){if(!n){const e=q.createSVG({data:o,delay:a?Number(a):void 0});n=new Image,n.src=`data:image/svg+xml,${encodeURIComponent(e)}`,n.addEventListener("load",(()=>{n.classList.add("img-loaded")}),{once:!0})}i.append(n)}function f(){n&&n.remove()}return l((()=>{if(!i)throw new Error("fumenElement is not available");F().observe(i,u,f)})),e.$$set=e=>{"data"in e&&r(0,o=e.data),"delay"in e&&r(4,a=e.delay),"width"in e&&r(1,c=e.width),"height"in e&&r(2,s=e.height)},[o,c,s,i,a,function(e){p[e?"unshift":"push"]((()=>{i=e,r(3,i)}))}]}class U extends e{constructor(e){super(),t(this,e,C,Q,r,{data:0,delay:4,width:1,height:2})}}export{U as default};
